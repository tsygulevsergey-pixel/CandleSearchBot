А) Двухсвечный ППР (как на твоём скрине)
1) Обязательные размеры (минимум)

Для первой (Bar₁) и второй (Bar₂) свечи обозначим:
Rᵢ = Hᵢ - Lᵢ (диапазон), Bᵢ = |Cᵢ - Oᵢ| (тело), ATR = ATR(n) на этом ТФ.

SELL-вариант (как на скрине сверху):

Закрепление: C₂ ≤ L₁ − ε·ATR (не просто касание, а закрытие ниже минимума Bar₁ на буфер ε·ATR). 
Trading Setups Review

Импульсность Bar₂:

R₂ ≥ k_ATR·ATR (бар не микро),

B₂ / R₂ ≥ 0.60 (тело ≥60% диапазона),

закрытие у низа: (C₂ − L₂) / R₂ ≤ 0.25. 
Webull

Сравнение с Bar₁: R₂ ≥ k_range·R₁ (например ≥1.2) — второй бар ощутимо мощнее первого. 
Trading Setups Review

BUY-вариант (симметрично):

C₂ ≥ H₁ + ε·ATR; R₂ ≥ k_ATR·ATR; B₂/R₂ ≥ 0.60; закрытие у верха: (H₂ − C₂)/R₂ ≤ 0.25; и R₂ ≥ k_range·R₁. 
Trading Setups Review

2) Геометрия (обязательная/желательная)

Желательно outside-bar: H₂ ≥ H₁ и L₂ ≤ L₁ (усиливает сигнал, но не обязалово). 
the5ers.com

Короткая тень со стороны закрытия: у sell — нижний хвост короткий; у buy — верхний хвост короткий (чёткий «drive»). 
Webull

3) Цвет свечей обязателен?

Нет. Сам паттерн определяется структурой закрытия, а не цветом. Совпадение цвета Bar₂ с направлением сделки — плюс к качеству, но не жёсткое условие. 
Trading Setups Review

4) Полная логика (чтобы отсечь «ерунду»)

Закрытие Bar₂ за экстремумом Bar₁ с буфером ε·ATR.

Bar₂ “импульсный”: большой диапазон и сильное позиционирование закрытия (см. выше).

Контекст:

торгуем преимущественно по HTF-bias (последняя закрытая свеча старшего ТФ),



Избегаем консолидации: требуем, чтобы закрытие Bar₂ вышло за край диапазона последних M баров (Donchian breakout), минимум на ε·ATR. 
tradingpedia.com

Объём (если есть): Vol₂ ≥ k_vol · SMA(Vol, n) — особенно важно на низких ТФ.

Подтверждение (опционально, для более чистых входов): следующая свеча пробивает экстремум Bar₂ в сторону сделки (даёт +надёжность ценой +задержки). 
Trading Setups Review

5) Сколько свечей нужно

Минимум 2 (твоя схема).

Консервативно — 3 (ждём подтв. свечу). 
Trading Setups Review

Б) Классический PPR (3-свечный Pivot Point Reversal)
1) Обязательные отношения

Контекст: тренд делает новый экстремум (Up: новый High; Down: новый Low).

Свеча №2 не продолжает прокол (не обновляет Low/High предыдущей по направлению тренда).

Свеча №3 закрывается за противоположным краем свечи №2 (и по факту разворачивает цену). 
binguru.net
+1

2) Критерии качества

Закрепление №3 за уровнем не просто на тик, а на ε·ATR.

Импульсность №3: B₃/R₃ ≥ 0.60, закрытие у экстремума (≤0.25 доли диапазона до края).

Размеры: R₃ ≥ k_ATR·ATR и R₃ ≥ k_range·R₂.

Контекст: HTF-bias
Мир трейдинга

3) Сколько свечей нужно

Минимум 3 (и часто ждут 4-ю на подтв./вход). 
Мир трейдинга

Рекомендованные пороги по ТФ (старт, потом докрутка)
Порог	15m	1h	4h
ε (буфер закрепления, в ATR)	0.20–0.25	0.15–0.20	0.10–0.15
k_ATR (минимум размера импульсного бара, в ATR)	≥1.2×	≥1.0×	≥0.8×
k_range (R₂/R₁ или R₃/R₂)	≥1.2×	≥1.1×	≥1.0×

k_vol к SMA(Vol,20)	≥1.3×	≥1.2×	≥1.1×

Логика: чем ниже ТФ, тем больше шума → усиливаем требования к буферу закрепления, «весу» импульсного бара и объёму. 
Trading Setups Review

Что чаще всего даёт ложные сигналы (и чем резать)

«Прилипание» к центру диапазона (флет): требуй выход закрытием за Donchian-край последних M баров. 
tradingpedia.com

Микро-бар импульса: включи R₂ (или R₃) ≥ k_ATR·ATR.

Закрепление «на тик»: используй буфер ε·ATR. 
Trading Setups Review

Контр-тренд без уровня: фильтр HTF-bias 
Мир трейдинга

Короткий чеклист для твоего конфига (без кода)

Включатели:

ppr_two_bar.enabled (двухсвечный вариант, как на скрине)

ppr_three_bar.enabled (классика PPR)

Общие пороги: epsilon_atr, impulse_min_atr (k_ATR), body_fraction_min (0.60), close_at_edge_max (0.25), range_ratio_min (k_range), donchian_confirm.M, sr_max_dist_atr (d), vol_k, htf_bias.enabled.

Входы:

агрессивный — сразу по закрытию импульсной свечи или пробой её экстремума;

консервативный — после ретеста/подтверждения.

Стоп-лосс (SL)
За «пробитым» уровнем Bar₁ + буфер

Лонг: SL = H₁ − δ·ATR (если вход от ретеста вверх)

Шорт: SL = L₁ + δ·ATR
Плюс: логично для ретеста; минус: шире, чем A.

Тейки (TP) и сопровождение
TP1 = 1R
TP2 = 2R

Рекомендованные M (Donchian lookback) для фильтра «закрытие за краем»

15m:

агрессивно (больше сигналов): M = 10

консервативно (чище): M = 14–20 → старт 12–14

1h:

агрессивно: M = 12

консервативно: M = 16–24 → старт 14–16

4h:

агрессивно: M = 10

консервативно: M = 14–20 → старт 10–14

Практика: начинай с 15m:12 / 1h:14 / 4h:10. Если много ложняка — подними M на 30–50%. Если сигналов мало — снизь на 20–30%.

Почему так

На низких ТФ шум выше → нужен больше буфер по M, чтобы «закрытие за краем» было осмысленным.

С ростом ТФ движению нужно меньше «истории» для подтверждения — M можно держать короче.

Деталь

Проверяй закрытие за DonchianHigh/Low(M) + ε·ATR (твои ε уже заданы для ТФ).

Один и тот же M используй и для верха, и для низа.