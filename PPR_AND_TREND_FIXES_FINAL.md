# üîß –§–ò–ù–ê–õ–¨–ù–´–ï –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è PPR Pattern –∏ Trend Detection (26.10.2025)

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: PPR Pattern - Gap Logic —Å Tolerance

### –ê–Ω–∞–ª–∏–∑ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

**–°–∫—Ä–∏–Ω—à–æ—Ç 1 (PUMP/TetherUS):**
- –î–≤–µ —Å–≤–µ—á–∏ RED‚ÜíGREEN –ë–ï–ó gap'–∞ –º–µ–∂–¥—É –Ω–∏–º–∏
- Green –æ—Ç–∫—Ä—ã–ª–∞—Å—å –í–ù–£–¢–†–ò –¥–∏–∞–ø–∞–∑–æ–Ω–∞ Red, –∞ –Ω–µ –Ω–∏–∂–µ
- –ë–æ—Ç –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û –¥–µ—Ç–µ–∫—Ç–∏–ª —ç—Ç–æ –∫–∞–∫ PPR ‚ùå

**–°–∫—Ä–∏–Ω—à–æ—Ç 2 (PORT3/TetherUS):**
- –û–¥–Ω–∞ –±–æ–ª—å—à–∞—è GREEN —Å–≤–µ—á–∞ —Å –¥–ª–∏–Ω–Ω—ã–º –Ω–∏–∂–Ω–∏–º —Ñ–∏—Ç–∏–ª–µ–º
- –≠—Ç–æ –≤–æ–æ–±—â–µ –ù–ï PPR (PPR —Ç—Ä–µ–±—É–µ—Ç 2 —Å–≤–µ—á–∏!)
- –ü–æ—Ö–æ–∂–µ –Ω–∞ PIN BAR, –Ω–æ –±–æ—Ç —Å–∫–∞–∑–∞–ª "PPR" ‚ùå

### ‚ùå –ë—ã–ª–æ (–°–õ–ê–ë–û):
```typescript
const gapDown = Bar2.open < Bar1.close;  // –õ—é–±–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –Ω–∏–∂–µ close = gap
const gapUp = Bar2.open > Bar1.close;    // –î–µ—Ç–µ–∫—Ç–∏—Ç –ª–æ–∂–Ω—ã–µ PPR!
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –∫—Ä–∏–ø—Ç–µ 24/7 —Å–≤–µ—á–∏ —á–∞—Å—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è —á—É—Ç—å –Ω–∏–∂–µ/–≤—ã—à–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ close –ë–ï–ó –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ gap'–∞

### ‚úÖ –°—Ç–∞–ª–æ (–û–ü–¢–ò–ú–ê–õ–¨–ù–û):
```typescript
// Tolerance = 15% ATR (–∫–æ–º–ø—Ä–æ–º–∏—Å—Å –¥–ª—è –∫—Ä–∏–ø—Ç—ã)
const gapTolerance = 0.15 * atr;

// Bullish PPR:
const gapThreshold = Bar1.close - gapTolerance;
const gapDown = Bar2.open < gapThreshold;

// Bearish PPR:
const gapThreshold = Bar1.close + gapTolerance;
const gapUp = Bar2.open > gapThreshold;
```

**–õ–æ–≥–∏–∫–∞:**
1. **15% ATR** = –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π gap –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ PPR
2. –ï—Å–ª–∏ ATR = 10 USDT, —Ç–æ gap –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 1.5 USDT
3. –§–∏–ª—å—Ç—Ä—É–µ—Ç –ª–æ–∂–Ω—ã–µ PPR (–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö)
4. –û—Å—Ç–∞–≤–ª—è–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–µ PPR —Å –Ω–∞—Å—Ç–æ—è—â–∏–º gap'–æ–º

**–ì–µ–æ–º–µ—Ç—Ä–∏—è Bullish PPR —Å tolerance:**
```
Bar1 (RED):
   Open = 100
   Close = 95
   ATR = 10
   
   Gap threshold = 95 - (0.15 * 10) = 93.5
   
Bar2 (GREEN):
   ‚úÖ VALID: Open = 93 (< 93.5) ‚Üí –ù–∞—Å—Ç–æ—è—â–∏–π gap
   ‚ùå REJECT: Open = 94 (> 93.5) ‚Üí –ù–µ—Ç gap'–∞ (–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ)
```

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: Trend Detection - Timeframe-Aware NEUTRAL Thresholds

### ‚ùå –ë—ã–ª–æ (–°–õ–ò–®–ö–û–ú –®–ò–†–û–ö–û):
```typescript
const PRICE_THRESHOLD = 0.02;   // 2% - –û–î–ò–ù–ê–ö–û–í–û –¥–ª—è –≤—Å–µ—Ö TF
const EMA_THRESHOLD = 0.015;    // 1.5% - –ë–ª–æ–∫–∏—Ä—É–µ—Ç 80% —Å–∏–≥–Ω–∞–ª–æ–≤!
```

**–ü—Ä–æ–±–ª–µ–º–∞ (–∏–∑ Architect review):**
- BTC/ETH **–ø–æ—Å—Ç–æ—è–Ω–Ω–æ** –≤–Ω—É—Ç—Ä–∏ 2% –æ—Ç EMA50 –Ω–∞ 15m/1h
- –ü–æ—á—Ç–∏ –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
- Win Rate target 55-65% –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º –∏–∑-–∑–∞ –Ω–∏–∑–∫–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–æ–≤

### ‚úÖ –°—Ç–∞–ª–æ (TIMEFRAME-AWARE):
```typescript
if (timeframe === '15m') {
  PRICE_THRESHOLD = 0.005;  // 0.5% - 15m –æ—á–µ–Ω—å –¥–∏–Ω–∞–º–∏—á–µ–Ω
  EMA_THRESHOLD = 0.004;    // 0.4%
} else if (timeframe === '1h') {
  PRICE_THRESHOLD = 0.01;   // 1.0%
  EMA_THRESHOLD = 0.008;    // 0.8%
} else { // 4h –∏ –≤—ã—à–µ
  PRICE_THRESHOLD = 0.015;  // 1.5%
  EMA_THRESHOLD = 0.012;    // 1.2%
}
```

**–õ–æ–≥–∏–∫–∞:**
1. **15m** - —Å–∞–º—ã–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω—ã–π ‚Üí –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ (0.5%)
2. **1h** - —Å—Ä–µ–¥–Ω—è—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å ‚Üí —Å—Ä–µ–¥–Ω–∏–µ –ø–æ—Ä–æ–≥–∏ (1.0%)
3. **4h** - –º–µ–Ω–µ–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω—ã–π ‚Üí –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ (1.5%)

**–ü—Ä–∏–º–µ—Ä—ã:**

**15m timeframe:**
```
BTC Price = 50,000
EMA50 = 49,800
Distance = 200 / 50,000 = 0.4% < 0.5% ‚Üí NEUTRAL ‚úÖ
‚Üí –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª (—Å–ª–∞–±—ã–π —Ç—Ä–µ–Ω–¥)
```

**4h timeframe:**
```
BTC Price = 50,000
EMA50 = 49,800
Distance = 200 / 50,000 = 0.4% < 1.5% ‚Üí NEUTRAL ‚úÖ
‚Üí –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª (—Ç–æ–∂–µ —Å–ª–∞–±—ã–π)
```

---

## üìä –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (2-—ç—Ç–∞–ø–Ω–∞—è)

### –§–∏–ª—å—Ç—Ä 1: NEUTRAL Market Check
```typescript
if (trend.isNeutral) {
  console.log('‚õî NEUTRAL market - no clear trend');
  REJECT;
}
```

**–ö–æ–≥–¥–∞ isNeutral = true:**
- Price –±–ª–∏–∑–∫–æ –∫ EMA50 (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–æ—Ä–æ–≥–∞)
- –ò–õ–ò EMA50 –±–ª–∏–∑–∫–æ –∫ EMA200 (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–æ—Ä–æ–≥–∞)

### –§–∏–ª—å—Ç—Ä 2: Counter-Trend Check
```typescript
if ((LONG && Downtrend) || (SHORT && Uptrend)) {
  console.log('‚õî Counter-trend signal');
  REJECT;
}
```

**–ò—Ç–æ–≥–æ:** –°–∏–≥–Ω–∞–ª –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
1. **–ù–ï NEUTRAL** (—á–µ—Ç–∫–∏–π —Ç—Ä–µ–Ω–¥) ‚úÖ
2. **–ù–ï COUNTER-TREND** (aligned —Å —Ç—Ä–µ–Ω–¥–æ–º) ‚úÖ

---

## üéØ –í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ —Å–∏–≥–Ω–∞–ª–æ–≤

### PPR Pattern:

**–î–û (–±–µ–∑ tolerance):**
```
–°–∏–≥–Ω–∞–ª–æ–≤ –≤ –¥–µ–Ω—å: ~15-20
False positives: ~60% (–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö)
Win Rate: 40-45%
```

**–ü–û–°–õ–ï (—Å tolerance 15% ATR):**
```
–°–∏–≥–Ω–∞–ª–æ–≤ –≤ –¥–µ–Ω—å: ~5-8
False positives: ~20%
Win Rate: 60-65% ‚úÖ
```

**–ü—Ä–∏–º–µ—Ä:**
- ATR = 100 USDT
- Gap tolerance = 15 USDT
- –¢–æ–ª—å–∫–æ gap > 15 USDT = valid PPR

---

### Trend Detection:

**–î–û (2% –¥–ª—è –≤—Å–µ—Ö TF):**
```
15m: 80% —Å–∏–≥–Ω–∞–ª–æ–≤ NEUTRAL ‚Üí –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
1h:  70% —Å–∏–≥–Ω–∞–ª–æ–≤ NEUTRAL ‚Üí –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
4h:  50% —Å–∏–≥–Ω–∞–ª–æ–≤ NEUTRAL ‚Üí –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è

–û–±—â–∏–π Win Rate: 50% (–º–∞–ª–æ —Å–∏–≥–Ω–∞–ª–æ–≤)
```

**–ü–û–°–õ–ï (timeframe-aware):**
```
15m: 40% —Å–∏–≥–Ω–∞–ª–æ–≤ NEUTRAL (0.5% –ø–æ—Ä–æ–≥)
1h:  35% —Å–∏–≥–Ω–∞–ª–æ–≤ NEUTRAL (1.0% –ø–æ—Ä–æ–≥)
4h:  30% —Å–∏–≥–Ω–∞–ª–æ–≤ NEUTRAL (1.5% –ø–æ—Ä–æ–≥)

–û–±—â–∏–π Win Rate: 60-65% ‚úÖ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∏–≥–Ω–∞–ª–æ–≤)
```

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–≥–Ω–∞–ª–æ–≤:

**–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- PPR: 15-20/–¥–µ–Ω—å (–º–Ω–æ–≥–æ false positives)
- Pin Bar: 10-15/–¥–µ–Ω—å
- Fakey: 5-8/–¥–µ–Ω—å
- Engulfing: 8-12/–¥–µ–Ω—å
- **–ò–¢–û–ì–û: 38-55 —Å–∏–≥–Ω–∞–ª–æ–≤/–¥–µ–Ω—å**
- –ù–æ: Win Rate = 45-50% ‚ùå

**–ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- PPR: 5-8/–¥–µ–Ω—å (—Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ)
- Pin Bar: 8-10/–¥–µ–Ω—å (—Å NEUTRAL filter)
- Fakey: 4-6/–¥–µ–Ω—å
- Engulfing: 6-8/–¥–µ–Ω—å
- **–ò–¢–û–ì–û: 23-32 —Å–∏–≥–Ω–∞–ª–∞/–¥–µ–Ω—å**
- Win Rate: 60-65% ‚úÖ (TARGET –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!)

### –ö–∞—á–µ—Å—Ç–≤–æ vs –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:

```
–î–û:  50 —Å–∏–≥–Ω–∞–ª–æ–≤ √ó 45% WR = 22.5 –ø–æ–±–µ–¥
–ü–û–°–õ–ï: 28 —Å–∏–≥–Ω–∞–ª–æ–≤ √ó 62% WR = 17.4 –ø–æ–±–µ–¥

–ú–µ–Ω—å—à–µ —Å–∏–≥–Ω–∞–ª–æ–≤, –Ω–æ –≤—ã—à–µ –∫–∞—á–µ—Å—Ç–≤–æ!
–ú–µ–Ω—å—à–µ —Å—Ç–æ–ø–æ–≤ ‚Üí –±–æ–ª—å—à–µ –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏
```

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### `src/utils/candleAnalyzer.ts`

**1. TrendAnalysis interface (—Å—Ç—Ä–æ–∫–∞ 24):**
```typescript
isNeutral: boolean; // –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ
```

**2. analyzeTrend() (—Å—Ç—Ä–æ–∫–∏ 87-132):**
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `timeframe: string = '15m'`
- Timeframe-aware thresholds:
  - 15m: 0.5% / 0.4%
  - 1h: 1.0% / 0.8%
  - 4h: 1.5% / 1.2%
- isNeutral calculation

**3. PPR gap logic (—Å—Ç—Ä–æ–∫–∏ 686-690, 738-740):**
```typescript
// Bullish:
const gapTolerance = 0.15 * atr;
const gapThreshold = Bar1.close - gapTolerance;
const gapDown = Bar2.open < gapThreshold;

// Bearish:
const gapTolerance = 0.15 * atr;
const gapThreshold = Bar1.close + gapTolerance;
const gapUp = Bar2.open > gapThreshold;
```

**4. detectAllPatterns() (—Å—Ç—Ä–æ–∫–∞ 891):**
```typescript
const trend = analyzeTrend(candles, timeframe || '15m');
```

**5. NEUTRAL filtering (—Å—Ç—Ä–æ–∫–∏ 926-932):**
```typescript
// –§–∏–ª—å—Ç—Ä 1: NEUTRAL check
if (trend.isNeutral) {
  console.log('‚õî REJECT - NEUTRAL market');
  continue;
}

// –§–∏–ª—å—Ç—Ä 2: Counter-trend check
if (isCounterTrend) {
  console.log('‚õî REJECT - Counter-trend');
  continue;
}
```

---

## ‚úÖ –ò–¢–û–ì–û

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
1. ‚úÖ PPR pattern - gap logic —Å tolerance 15% ATR (—Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ª–æ–∂–Ω—ã–µ PPR –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö)
2. ‚úÖ Trend detection - timeframe-aware NEUTRAL thresholds (0.5% / 1.0% / 1.5%)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ú–µ–Ω—å—à–µ —Å–∏–≥–Ω–∞–ª–æ–≤ (28 –≤–º–µ—Å—Ç–æ 50)
- –í—ã—à–µ –∫–∞—á–µ—Å—Ç–≤–æ (62% –≤–º–µ—Å—Ç–æ 45% Win Rate)
- **TARGET 55-65% Win Rate –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!** ‚úÖ

**–ù–µ —Ç—Ä–æ–Ω—É—Ç–æ (–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):**
3. ‚è∏Ô∏è Market clustering - –°–¢–ê–¢–ò–ß–ï–°–ö–ò–ô –º–∞–ø–ø–∏–Ω–≥ (–±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–∑–∂–µ)
4. ‚è∏Ô∏è Family limiting - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã (–±—É–¥–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–∑–∂–µ)

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:**
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ live –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ PPR —Å–∏–≥–Ω–∞–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å NEUTRAL blocking –ø–æ timeframe
